# ACTION	CONTENT	TIMEOUT	PROGRESS

# Booting
wait_for_str	'Starting kernel ...'	30	BOOTING

# Log in
wait_for_str	' login:'	90	LOGGING IN
wait_for_second	5
send	'unicorn\n'	5
wait_for_second	10
send	'$5$iCBBUel6L8yF$dz0KBnsv2dYEndH47QwpnS6kbM2KVNoK3gedGdb4v80\n'	5
wait_for_second	15
# Switch to root
send	'su\n'	5
wait_for_regex	r'\b((flo\-[0-9A-Fa-f]{12}:)/.*#)'	10	LOGGED IN

# Get device ID
send	'cat /sys/class/net/wlan0/address\n'	5
wait_for_regex	r'\b(([0-9A-Fa-f]{2}:){5}([0-9A-Fa-f]{2})|([0-9A-Fa-f]{2}-){5}([0-9A-Fa-f]{2}))\b'	5	MAC: \1

# Detect button click
send	'cat /dev/input/event1 | hexdump\n'	5	DETECTING BUTTON CLICK
wait_for_regex	r'\b(([0-9A-Za-z]{7}\s){1}([0-9A-Za-z]{4}\s){7}([0-9A-Za-z]{4}){1})\b'	30
send	'\x03'	5
send	'\n'	5
wait_for_regex	r'\b((flo\-[0-9A-Fa-f]{12}:)/.*#)'	5	DETECTED BUTTON CLICK

# Detect hall effect sensor event
send	'systemctl stop uni-sensord\n'	5	DETECTING HALL EFFECT SENSOR EVENT
wait_for_regex	r'\b((flo\-[0-9A-Fa-f]{12}:)/.*#)'	5
send	'cat /dev/flow_pulse\n'	5
wait_for_regex	r'(Period":\s[0-9]{2,})'	30
send	'\x03'	5
send	'\n'	5
wait_for_regex	r'\b((flo\-[0-9A-Fa-f]{12}:)/.*#)'	5	DETECTED HALL EFFECT SENSOR EVENT

# Done
send	'exit\n'	5
send	'exit\n'	5	DONE
